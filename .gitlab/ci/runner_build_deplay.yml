build_deploy_runner_image:
  stage: build_runner
  image: docker:20.10.16
  variables:
    DOCKER_IMAGE_NAME: huddlesk/uv-ansible-terraform-alpine
    BASE_DOCKER_IMAGE_TAG: 0-10.2-2.1-14.2
  when: manual
  services:
    - docker:20.10.16-dind
  before_script:
    - apk add --no-cache git
    - echo "$DOCKERHUB_TOKEN" | docker login -u "$DOCKERHUB_USERNAME" --password-stdin
    - if [ -n "$CI_COMMIT_TAG" ]; then
        echo "Build for $CI_COMMIT_TAG";
        export LATEST_TAG="$CI_COMMIT_TAG";
      else
        export LATEST_TAG=$(git describe --tags --abbrev=0);
        echo "Build for $LATEST_TAG";
      fi
  script:
    - docker version
    #- docker build -t $DOCKER_IMAGE_NAME:$LATEST_TAG .
    #- docker push $DOCKER_IMAGE_NAME:$LATEST_TAG
  #rules:
    #- if: '$CI_COMMIT_TAG != null'
    #- if: $CI_PIPELINE_SOURCE == "web"
    #- if: $CI_COMMIT_BRANCH == $CI_DEFAULT_BRANCH  # Enables a pipelines on main