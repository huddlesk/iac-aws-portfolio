spec:
  inputs:
    environment: # Provide this on job run from the GitLab UI
      type: string
      options: ["dev", "prod"]
      default: "dev" 
      description: "Select the environment to deploy to"
---
provision:
  stage: provision
  environment: $[[ inputs.environment ]]
  when: manual
  script:
    - cd terraform/environments/$[[ inputs.environment ]]
    - terraform init
    - terraform apply -auto-approve tfplan
  needs:
    - lint_and_plan